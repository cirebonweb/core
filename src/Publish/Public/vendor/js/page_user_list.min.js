/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
const $statContainer=$(".statContainer"),$tabelData=$("#tabelData"),$formData=$("#formData"),$modalDiv=$("#modal-div"),formCek=CirebonwebForm.FormCek($formData);function simpan(userId){let $modalTitle=$(".modal-title"),$btnSubmit=$("#btnSubmit"),postUrl="";userId>0?CirebonwebForm.FormFetch("user-list/get-id",{userId:userId},"POST",{}).done((function(response){response.success&&($modalTitle.text("Edit Data"),$btnSubmit.text("Update"),postUrl="user-list/update",$formData.find("#iduser").val(response.data.iduser),$formData.find("#username").val(response.data.username),$formData.find("#email").val(response.data.email),$formData.find("#aktivasi").val(response.data.active),$formData.find("#akses").val(response.data.group),$modalDiv.modal("show"))})):($("#iduser").val(""),$modalTitle.text("Tambah Data"),$btnSubmit.text("Simpan"),postUrl="user-list/simpan",$modalDiv.modal("show")),$formData.validate($.extend(CirebonwebForm.FormValidasi(),{rules:{username:{required:!0,minlength:3,maxlength:30},email:{required:!0,customEmail:!0},password:{required:!1,minlength:8},password_confirm:{required:!1,equalTo:"#password"}},submitHandler:function(){return!!formCek.isChanged()&&(CirebonwebForm.FormFetch(postUrl,$formData.serializeArray(),"POST",{before_call:function(){if(!formCek.isChanged())return!1;$btnSubmit.attr("disabled",!0).html('<span class="spinner-border spinner-border-sm mr-1" role="status" aria-hidden="true"></span> Loading...')},after_call:function(){$btnSubmit.attr("disabled",!1).html("Submit")}}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((function(){$modalDiv.modal("hide"),$tabelData.DataTable().ajax.reload(null,!1),$statContainer.CirebonwebStat("refresh")}))})),!1)}}))}function cekpwd(){"password"===$(".passwd").get(0).type?($(".ikon").html("<i class='bi bi-eye-slash-fill'></i>"),$("#password, #password_confirm").each((function(){this.type="text"}))):($(".ikon").html("<i class='bi bi-eye-fill'></i>"),$("#password, #password_confirm").each((function(){this.type="password"})))}function updateStatus(select,iduser){const active=select.value;CirebonwebForm.FormFetch("user-list/update-status",{iduser:iduser,active:active},"POST",{}).done((function(response){response.success?Swal.fire("Sukses",response.messages,"success").then((function(){$statContainer.CirebonwebStat("refresh")})):$tabelData.DataTable().ajax.reload(null,!1)})).fail((function(){$tabelData.DataTable().ajax.reload(null,!1)}))}function updateGrup(select,iduser){const group=select.value;CirebonwebForm.FormFetch("user-list/update-grup",{iduser:iduser,group:group},"POST",{}).done((function(response){response.success?Swal.fire("Sukses",response.messages,"success").then((function(){$statContainer.CirebonwebStat("refresh")})):$tabelData.DataTable().ajax.reload(null,!1)})).fail((function(){$tabelData.DataTable().ajax.reload(null,!1)}))}$((function(){$statContainer.CirebonwebStat({endpoint:"/admin/statistik/user-list"}),$tabelData.DataTable({processing:!0,serverSide:!0,ajax:{url:"user-list/tabel",type:"POST",data:function(d){d.filter_active=$("#filter_active").val(),d.filter_group=$("#filter_group").val()}},autoWidth:!1,responsive:!0,search:{return:!0},dom:"Blfrtip",buttons:[{text:"Add",action:()=>{onclick=simpan()}},{text:"Reload",action:function(e,dt,node,config){dt.search("").draw(),$("#filter_active").val("").trigger("change"),$("#filter_group").val("").trigger("change"),swal.fire("Informasi","Selesai reload tabel ke kondisi awal","success").then((function(){dt.ajax.reload(null,!0),$statContainer.CirebonwebStat("refresh")}))}},{extend:"excelHtml5",exportOptions:{columns:[0,1,2,9,10,5,6,7]}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,3,4,8],className:"dt-body-center"},{targets:[5,6,7],className:"dt-body-right",render:function(data,type,row){return CirebonwebFormat.Tanggal(data)}},{targets:8,orderable:!1},{targets:[9,10],visible:!1}]}),$("#tabelData_filter.dataTables_filter").append($("#filter_active, #filter_group")),$(document).on("change","#filter_active, #filter_group",(function(){$tabelData.DataTable().ajax.reload(null,!1)}))})),$modalDiv.on("shown.bs.modal",(function(){formCek.resetInitial()})),$modalDiv.on("hidden.bs.modal",(function(){CirebonwebForm.FormReset(this)}));