/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
let baseUrl=window.location.href;window.Lokasi={urlSimpan:`${baseUrl}/simpan`,urlTabel:`${baseUrl}/tabel`,urlHapus:`${baseUrl}/hapus`,urlHapusExpired:`${baseUrl}/hapus-expired`};const $tabelData=$("#tabelData");$((function(){$tabelData.DataTable({processing:!0,serverSide:!1,ajax:{url:"cache/tabel",type:"POST"},autoWidth:!1,responsive:!0,search:{return:!0},dom:"Blfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:":visible:not(:eq(5))"}},{text:"Clear",attr:{id:"btn-delete-expired"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,7],className:"dt-body-center"},{targets:[2,3,4],className:"dt-body-right"},{targets:[5,6,7],orderable:!1},{targets:[0,2,3,4,5,6,7],searchable:!1}],initComplete:function(){let api=this.api(),filterContainer=$("#tabelData_filter"),extraFilters=$('<div class="ml-2 d-inline-block"></div>');api.columns(1).every((function(){let column=this,headerText=$(column.header()).text().trim(),select=$('<select class="form-control form-control-sm d-inline-block w-auto mr-1"><option value=""># '+headerText+"</option></select>").appendTo(extraFilters).on("change",(function(){let val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?"^"+val+"$":"",!0,!1).draw()}));column.data().unique().sort().each((function(d){let text=$("<div>").html(d).text().trim();select.append('<option value="'+text+'">'+text+"</option>")}))})),filterContainer.append(extraFilters)}})})),$((function(){function updateMenitLabel($input){const detik=parseInt($input.val(),10),$menitLabel=$input.closest(".input-group").find(".menit");if(0===detik)$menitLabel.text("Lifetime");else{const menit=Math.round(detik/60);$menitLabel.text(menit+" menit")}}$('input[type="number"]').each((function(){updateMenitLabel($(this))})),$('input[type="number"]').on("input change",(function(){updateMenitLabel($(this))}))})),$((function(){let $formId=$("#cacheForm"),$btnSubmit=$("#cacheSubmit"),formCek=CirebonwebForm.FormCek($formId);$formId.validate($.extend(CirebonwebForm.FormValidasi(),{ignore:[],rules:{cache_geoip:{required:!0,digits:!0},cache_device:{required:!0,digits:!0},statistik_user_list:{required:!0,digits:!0},statistik_user_login:{required:!0,digits:!0},statistik_log_email:{required:!0,digits:!0}},submitHandler:function(){return!!formCek.isChanged()&&(CirebonwebForm.FormFetch("cache/simpan",$formId.serializeArray(),"POST",{before_call:function(){if(!formCek.isChanged())return!1;$btnSubmit.attr("disabled",!0).html('<span class="spinner-border spinner-border-sm mr-1" role="status" aria-hidden="true"></span> Loading...')},after_call:function(){$btnSubmit.attr("disabled",!1).html("Simpan")}}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{formCek.resetInitial(),CirebonwebForm.FormReset($formId)}))})),!1)}}))})),$(document).on("click",".btn-delete",(function(e){e.preventDefault();let filename=$(this).data("filename");Swal.fire({title:"Konfirmasi",text:"Hapus file: "+filename,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("cache/hapus",{filename:filename},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)}))})),!1}))})),$(document).on("click","#btn-delete-expired",(function(e){e.preventDefault(),Swal.fire({title:"Konfirmasi",text:"Hapus semua file cache yang sudah expired?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("cache/hapus-expired",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)}))})),!1}))}));