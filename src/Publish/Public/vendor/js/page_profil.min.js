/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
function cekpwd(){"password"===$(".passwd").get(0).type?($(".ikon").html("<i class='bi bi-eye-slash'></i>"),$("#password, #password_confirm").each((function(){this.type="text"}))):($(".ikon").html("<i class='bi bi-eye'></i>"),$("#password, #password_confirm").each((function(){this.type="password"})))}$((function(){$('[data-toggle="tooltip"]').tooltip()})),$((function(){const $sesiPaginationContainer=$("#sesi-pagination-container");let $sesiForm=$("#sesi-form"),$btnHapusSesi=$("#btn-hapus-sesi"),$btnSpinner=$btnHapusSesi.find(".spinner-border"),$btnText=$btnHapusSesi.find(".btn-text"),$sesiListContainer=$("#sesi-list-container");function loadPerangkat(page=1){$btnHapusSesi.prop("disabled",!0),$btnSpinner.show(),$btnText.text("Memuat..."),$sesiListContainer.html('<p class="text-center">Mengambil data perangkat...</p>'),$sesiPaginationContainer.empty(),setTimeout((function(){$.ajax({url:`${$urlGetPerangkat}?page=${page}`,type:"GET",dataType:"json"}).done((function(data){setTimeout((function(){if($sesiListContainer.empty(),data.sessions&&data.sessions.length>0){let htmlContent='<div class="row">';data.sessions.forEach((s=>{htmlContent+=`\n                                <div class="col-md-6">\n                                    <div class="d-flex align-items-center">\n                                        <i class="bi ${s.device} ${s.warna}" style="font-size: 65px; line-height: 1"></i>\n                                        <div>\n                                            <i class="bi ${s.ikon}"></i> ${escapeHtml(s.os)} - ${escapeHtml(s.browser)} <br>\n                                            <i class="bi ${s.ikon}"></i> ${escapeHtml(s.ip_publik)} <br>\n                                            <i class="bi ${s.remember}"></i> Ingat saya\n                                        </div>\n                                    </div>\n                                    <div class="mt-1 mb-4"> ${s.status}</div>\n                                </div>`})),htmlContent+="</div>",$sesiListContainer.html(htmlContent),$sesiPaginationContainer.html(data.pager),data.total<=1?($btnHapusSesi.prop("disabled",!0),$btnText.text("Satu perangkat aktif")):($btnHapusSesi.prop("disabled",!1),$btnText.text("Keluar dari perangkat lain"))}else $sesiListContainer.html('<p class="text-muted">Tidak ada perangkat aktif.</p>'),$btnHapusSesi.prop("disabled",!0),$btnText.text("Tidak ada perangkat lain")}),250)})).fail((function(){$sesiListContainer.html('<p class="text-danger">Gagal memuat daftar perangkat.</p>'),$btnText.text("Gagal Memuat")})).always((function(){setTimeout((function(){$btnSpinner.hide()}),250)}))}),250)}function escapeHtml(text){if("string"!=typeof text)return"";var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return text.replace(/[&<>"']/g,(m=>map[m]))}$(document).on("click","#sesi-pagination-container .pagination a",(function(e){e.preventDefault();const href=$(this).attr("href"),page=new URL(href).searchParams.get("page");page&&(loadPerangkat(page),$("html, body").animate({scrollTop:$sesiListContainer.offset().top-20},250))})),$sesiForm.on("submit",(function(e){e.preventDefault(),Swal.fire({title:"Konfirmasi",text:"Keluar dari semua perangkat lain?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("profil/logout-perangkat",{},"POST",{before_call:function(){$btnHapusSesi.prop("disabled",!0),$btnSpinner.show(),$btnText.text("Memproses...")},after_call:function(){$btnSpinner.hide(),$btnText.text("Logout Perangkat Lain")}}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{loadPerangkat()}))})),!1}))})),isPemilikProfil&&loadPerangkat(1)})),$((function(){let $akunForm=$("#akunForm"),$btnSubmit=$("#akunSubmit"),formCek=CirebonwebForm.FormCek($akunForm);$akunForm.validate($.extend(CirebonwebForm.FormValidasi(),{rules:{username:{required:!0,minlength:3,maxlength:30},email:{required:!0,customEmail:!0},password:{required:!1,minlength:8},password_confirm:{required:!1,equalTo:"#password"}},submitHandler:function(){return!!formCek.isChanged()&&(CirebonwebForm.FormFetch("profil/update-akun",$akunForm.serializeArray(),"POST",{before_call:function(){if(!formCek.isChanged())return!1;$btnSubmit.attr("disabled",!0).html('<span class="spinner-border spinner-border-sm mr-1" role="status" aria-hidden="true"></span> Loading...')},after_call:function(){$btnSubmit.attr("disabled",!1).html("Simpan")}}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{formCek.resetInitial(),CirebonwebForm.FormReset($akunForm)}))})),!1)}}))})),$((function(){let $infoForm=$("#infoForm"),$btnSubmit=$("#infoSubmit"),formCek=CirebonwebForm.FormCek($infoForm);$infoForm.validate($.extend(CirebonwebForm.FormValidasi(),{rules:{perusahaan:{required:!1,minlength:5,maxlength:30},whatsapp:{required:!1,digits:!0,minlength:8,maxlength:15},telegram:{required:!1,digits:!0,minlength:8,maxlength:15},alamat:{required:!1,minlength:10,maxlength:100}},submitHandler:function(){return!!formCek.isChanged()&&(CirebonwebForm.FormFetch("profil/update-info",$infoForm.serializeArray(),"POST",{before_call:function(){if(!formCek.isChanged())return!1;$btnSubmit.attr("disabled",!0).html('<span class="spinner-border spinner-border-sm mr-1" role="status" aria-hidden="true"></span> Loading...')},after_call:function(){$btnSubmit.attr("disabled",!1).html("Simpan")}}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{formCek.resetInitial(),CirebonwebForm.FormReset($infoForm)}))})),!1)}}))}));