/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
const $statContainer=$(".statContainer"),$tabelData=$("#tabelData");$((function(){$('[data-toggle="tooltip"]').tooltip(),$statContainer.CirebonwebStat({endpoint:"optimasi/get-info"}),$tabelData.DataTable({ajax:{url:"optimasi/db-tabel",type:"POST",dataType:"json",dataSrc:"data"},columns:[{data:"no"},{data:"tabel"},{data:"baris",render:function(data){return parseInt(data)+" data"}},{data:"tipe"},{data:"kelompok"},{data:"ukuran",render:function(data){return parseFloat(data).toFixed(2)+" MB"}},{data:"overhead",render:function(data){return parseFloat(data).toFixed(2)+" KB"}},{data:"dirubah",render:CirebonwebFormat.Tanggal}],order:[[0,"asc"]],paging:!0,searching:!1,responsive:!0,autoWidth:!1,pageLength:25,dom:"Blfrtip",buttons:["excel",{text:"Refresh",attr:{id:"btn-db-refresh"}}],columnDefs:[{targets:0,width:"5%"},{targets:[0,3,4,7],className:"dt-body-center"},{targets:[2,5,6],className:"dt-body-right"},{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6,7],searchable:!1}],footerCallback:function(row,data){let totalBaris=0,totalUkuran=0,totalOverhead=0;data.forEach((function(d){totalBaris+=parseInt(d.baris),totalUkuran+=parseFloat(d.ukuran),totalOverhead+=parseFloat(d.overhead)}));const api=this.api();$(api.column(2).footer()).html(totalBaris+" data"),$(api.column(5).footer()).html(totalUkuran.toFixed(2)+" MB"),$(api.column(6).footer()).html(totalOverhead.toFixed(2)+" KB"),api.on("xhr.dt",(function(){$statContainer.CirebonwebStat("refresh")}))}})})),$(document).on("click","#btn-db-refresh",(function(e){e.preventDefault(),Swal.fire({title:"Konfirmasi",html:"Generate ulang tabel database?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("optimasi/db-refresh",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)}))})),!1}))})),document.querySelector("#btn-hapus-log").addEventListener("click",(function(){const el=document.querySelector('[data-key="logSize"]');parseFloat(el?.textContent??"0")<=0?Swal.fire({icon:"warning",title:"Peringatan",html:"Ukuran file log 0 MB. <br> Tidak ada yang perlu dibersihkan.",confirmButtonText:"OK"}):Swal.fire({title:"Konfirmasi",html:"Perintah ini akan menghapus semua <br> file log sistem. Lanjutkan?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("optimasi/hapus-log",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$statContainer.CirebonwebStat("refresh")}))})),!1}))})),document.querySelector("#btn-hapus-debug").addEventListener("click",(function(){const el=document.querySelector('[data-key="debugSize"]');parseFloat(el?.textContent??"0")<=0?Swal.fire({icon:"warning",title:"Peringatan",html:"Ukuran file debug 0 MB. <br> Tidak ada yang perlu dibersihkan.",confirmButtonText:"OK"}):Swal.fire({title:"Konfirmasi",html:"Perintah ini akan menghapus semua <br> file debug sistem. Lanjutkan?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("optimasi/hapus-debug",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$statContainer.CirebonwebStat("refresh")}))})),!1}))})),document.querySelector("#btn-db-optimasi").addEventListener("click",(function(){const cooldownText=document.querySelector('[data-key="dbOptimasiTime"]')?.textContent??"";if(cooldownText.includes("Belum pernah"));else{const match=cooldownText.match(/(\d+)\s+hari/),hari=match?parseInt(match[1]):0;if(hari<30)return void Swal.fire({title:"Peringatan",html:`Optimasi database dapat dilakukan setiap 30 hari. Terakhir dilakukan ${hari} hari yang lalu.`,icon:"warning"})}Swal.fire({title:"Konfirmasi",html:"Proses optimasi database memerlukan waktu beberapa menit. Lanjutkan?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("optimasi/db-optimasi",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)}))})),!1}))})),document.querySelector("#btn-db-analisis").addEventListener("click",(function(){const cooldownText=document.querySelector('[data-key="dbAnalisisTime"]')?.textContent??"";if(cooldownText.includes("Belum pernah"));else{const match=cooldownText.match(/(\d+)\s+hari/),hari=match?parseInt(match[1]):0;if(hari<30)return void Swal.fire({title:"Peringatan",html:`Analisis database dapat dilakukan setiap 30 hari. Terakhir dilakukan ${hari} hari yang lalu.`,icon:"warning"})}Swal.fire({title:"Konfirmasi",html:"Proses analisis database memerlukan waktu beberapa menit. Lanjutkan?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed)return CirebonwebForm.FormFetch("optimasi/db-analisis",{},"POST",{}).done((function(response){response.success&&Swal.fire("Sukses",response.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)}))})),!1}))}));