/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
function cekpwd(){"password"===$(".passwd").get(0).type?($(".ikon").html("<i class='bi bi-eye-slash'></i>"),$("#password, #password_confirm").each((function(){this.type="text"}))):($(".ikon").html("<i class='bi bi-eye'></i>"),$("#password, #password_confirm").each((function(){this.type="password"})))}$((function(){$('[data-toggle="tooltip"]').tooltip()})),$((function(){const $sesiPaginationContainer=$("#sesi-pagination-container");let $sesiForm=$("#sesi-form"),$btnHapusSesi=$("#btn-hapus-sesi"),$btnSpinner=$btnHapusSesi.find(".spinner-border"),$btnText=$btnHapusSesi.find(".btn-text"),$sesiListContainer=$("#sesi-list-container");function loadPerangkat(page=1){$btnHapusSesi.prop("disabled",!0),$btnSpinner.show(),$btnText.text("Memuat..."),$sesiListContainer.html('<p class="text-center">Mengambil data perangkat...</p>'),$sesiPaginationContainer.empty(),setTimeout((function(){$.ajax({url:`${$urlGetPerangkat}?page=${page}`,type:"GET",dataType:"json"}).done((function(data){setTimeout((function(){if($sesiListContainer.empty(),data.sessions&&data.sessions.length>0){let htmlContent='<div class="row">';data.sessions.forEach((s=>{htmlContent+=`\n <div class="col-md-6">\n <div class="d-flex align-items-center">\n <i class="bi ${s.device} ${s.warna}" style="font-size: 65px; line-height: 1"></i>\n <div>\n <i class="bi ${s.ikon}"></i> ${escapeHtml(s.os)} - ${escapeHtml(s.browser)} <br>\n <i class="bi ${s.ikon}"></i> ${escapeHtml(s.ip_publik)} <br>\n <i class="bi ${s.remember}"></i> Ingat saya\n </div>\n </div>\n <div class="mt-1 mb-4"> ${s.status}</div>\n </div>`})),htmlContent+="</div>",$sesiListContainer.html(htmlContent),$sesiPaginationContainer.html(data.pager),data.total<=1?($btnHapusSesi.prop("disabled",!0),$btnText.text("Hanya 1 perangkat aktif")):($btnHapusSesi.prop("disabled",!1),$btnText.text("Keluar dari perangkat lain"))}else $sesiListContainer.html('<p class="text-muted">Tidak ada perangkat aktif.</p>'),$btnHapusSesi.prop("disabled",!0),$btnText.text("Tidak ada perangkat lain")}),250)})).fail((function(){$sesiListContainer.html('<p class="text-danger">Gagal memuat daftar perangkat.</p>'),$btnText.text("Gagal Memuat")})).always((function(){setTimeout((function(){$btnSpinner.hide()}),250)}))}),250)}function escapeHtml(text){if("string"!=typeof text)return"";var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return text.replace(/[&<>"']/g,(m=>map[m]))}$(document).on("click","#sesi-pagination-container .pagination a",(function(e){e.preventDefault();const href=$(this).attr("href"),page=new URL(href).searchParams.get("page");page&&(loadPerangkat(page),$("html, body").animate({scrollTop:$sesiListContainer.offset().top-20},250))})),$sesiForm.on("submit",(function(e){e.preventDefault(),Swal.fire({title:"Konfirmasi",text:"Keluar dari semua perangkat lain?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{result.isConfirmed&&($btnHapusSesi.prop("disabled",!0),$btnSpinner.show(),$btnText.text("Memproses..."),$.ajax({url:$urlLogoutPerangkat,type:"POST",dataType:"json"}).done((function(res){res.success?Swal.fire("Berhasil!",res.messages,"success").then((()=>{Beranda.refreshCsrf(),loadPerangkat()})):Swal.fire("Gagal",res.messages,"error")})).fail((function(xhr){const msg=xhr.responseJSON?.messages||xhr.responseText||"Terjadi kesalahan saat memproses.";Swal.fire("Gagal",msg,"error")})).always((function(){$btnSpinner.hide(),$btnText.text("Logout Perangkat Lain")})))}))})),isPemilikProfil&&loadPerangkat(1)})),$((function(){let $akunForm=$("#akun-form"),$akunSubmit=$("#akun-submit"),$akunLoading=$("#akun-loading");$akunLoading.hide();let formCekAkun=FormHelper.cekFormData($akunForm);$akunForm.validate($.extend(FormHelper.validasiForm(),{rules:{username:{required:!0,minlength:3,maxlength:30},email:{required:!0,customEmail:!0},password:{required:!1,minlength:8},password_confirm:{required:!1,equalTo:"#password"}},submitHandler:form=>($akunForm.find(":input").removeClass("is-invalid is-valid"),!!formCekAkun.isChanged()&&FormHelper.submitForm(form,$urlAkun,$akunSubmit,$akunLoading,{formCek:formCekAkun}))}))})),$((function(){let $infoForm=$("#info-form"),$infoSubmit=$("#info-submit"),$infoLoading=$("#info-loading");$infoLoading.hide();let formCekInfo=FormHelper.cekFormData($infoForm);$infoForm.validate($.extend(FormHelper.validasiForm(),{rules:{perusahaan:{required:!1,minlength:5,maxlength:30},whatsapp:{required:!1,digits:!0,minlength:8,maxlength:15},telegram:{required:!1,digits:!0,minlength:8,maxlength:15},alamat:{required:!1,minlength:10,maxlength:100}},submitHandler:form=>($infoForm.find(":input").removeClass("is-invalid is-valid"),!!formCekInfo.isChanged()&&FormHelper.submitForm(form,$urlInfo,$infoSubmit,$infoLoading,{formCek:formCekInfo}))}))}));