/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
const $tabelData=$("#tabel-data"),$modalDiv=$("#modal-div"),$formData=$("#form-data");let formCek=FormHelper.cekFormData($formData),baseUrl=window.location.href;window.Lokasi={urlTabel:`${baseUrl}/tabel`,urlGetId:`${baseUrl}/get-id`,urlSimpan:`${baseUrl}/simpan`,urlUpdate:`${baseUrl}/update`},$modalDiv.on("shown.bs.modal",(function(){formCek.resetInitial()})),$modalDiv.on("hidden.bs.modal",(function(){FormHelper.resetFormValidation(this)}));const $statContainer=$(".stat-container");function cekpwd(){"password"===$(".passwd").get(0).type?($(".ikon").html("<i class='bi bi-eye-slash-fill'></i>"),$("#password, #password_confirm").each((function(){this.type="text"}))):($(".ikon").html("<i class='bi bi-eye-fill'></i>"),$("#password, #password_confirm").each((function(){this.type="password"})))}function simpan(userId){let $modalTitle=$(".modal-title"),$btnSubmit=$("#btn-submit"),$btnLoading=$("#btn-loading"),$btnClose=$("#btn-close");$btnLoading.hide(),$formData[0].reset(),!userId||userId<1?(urlController=Lokasi.urlSimpan,submitText="Simpan",$modalTitle.text("Tambah User"),$btnSubmit.text(submitText),$modalDiv.modal("show")):$.ajax({url:Lokasi.urlGetId,type:"POST",data:{userId:userId},dataType:"json",success:function(response){response?(urlController=Lokasi.urlUpdate,submitText="Update",$modalTitle.text("Edit User"),$btnSubmit.text(submitText),$formData.find("#iduser").val(response.iduser),$formData.find("#username").val(response.username),$formData.find("#email").val(response.email),$formData.find("#aktivasi").val(response.active),$formData.find("#akses").val(response.group),$modalDiv.modal("show")):Swal.fire("Error","Data user tidak ditemukan.","error")},error:function(jqXHR,textStatus){Swal.fire("Error","Akses data user gagal: "+textStatus,"error")}}),$formData.validate($.extend(FormHelper.validasiForm(),{ignore:[],rules:{username:{required:!0,minlength:3,maxlength:30},email:{required:!0,customEmail:!0},password:{required:!1,minlength:8},password_confirm:{required:!1,equalTo:"#password"}},submitHandler:form=>!!formCek.isChanged()&&FormHelper.submitForm(form,urlController,$btnSubmit,$btnLoading,{$tabelData:$tabelData,$modalDiv:$modalDiv,$btnClose:$btnClose})}))}function updateGrup(selectElement,iduser){const grup=selectElement.value;FetchHelper.postJson("user-list/update-grup",{iduser:iduser,grup:grup},{onSuccess:()=>{$tabelData.DataTable().ajax.reload(null,!1)}})}function updateAktif(selectElement,iduser){const aktif=selectElement.value;FetchHelper.postJson("user-list/update-aktif",{iduser:iduser,aktif:aktif},{onSuccess:()=>{$tabelData.DataTable().ajax.reload(null,!1)}})}$(document).ready((function(){$statContainer.HelperStatBox({endpoint:"/admin/statistik/user-list"})})),TabelHelper.tabelDinamis($tabelData,Lokasi.urlTabel,[{text:"Add",action:()=>{onclick=simpan()}},{extend:"excelHtml5",text:"Excel",exportOptions:{columns:":visible:not(:eq(8))",format:{body:function(data,row,column,node){return $("<div>").html(data).text().trim()}}}}],[{targets:0,width:"5%"},{targets:[0,3,4,5,6,7,8],className:"dt-body-center"},{targets:"_all",className:"dt-head-center"},{targets:[2,3,4,5,6,7,8,9,10],orderable:!1},{targets:[0,5,6,7,8],searchable:!1},{targets:[5,6,7],render:TabelHelper.tabelTanggalWaktu}],[[0,"asc"]],{initComplete:function(){let api=this.api(),filterContainer=$("#tabel-data_filter"),extraFilters=$('<div class="ml-2 d-inline-block"></div>');api.columns([9,10]).every((function(){let column=this,headerText=$(column.header()).text().trim(),select=$('<select class="form-control form-control-sm d-inline-block w-auto mr-1"><option value=""># '+headerText+"</option></select>").appendTo(extraFilters).on("change",(function(){let val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?"^"+val+"$":"",!0,!1).draw()}));column.data().unique().sort().each((function(d){let text=$("<div>").html(d).text().trim();select.append('<option value="'+text+'">'+text+"</option>")}))})),filterContainer.append(extraFilters),api.on("xhr.dt",(function(){$statContainer.HelperStatBox("refresh")}))}});