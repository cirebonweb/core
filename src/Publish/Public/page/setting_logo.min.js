/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
document.querySelectorAll('input[type="file"]').forEach((input=>{input.addEventListener("change",(function(e){const file=e.target.files[0];if(!file||!file.type.match(/image.*/))return;const kotak=e.target.closest(".kotak"),spinner=kotak.querySelector(".loadingSpinner"),preview=kotak.querySelector("img"),info=kotak.querySelector('div[id$="Info"]'),reader=new FileReader;reader.onload=function(event){const img=new Image;img.onload=function(){if(file.size<=102400)return preview.src=URL.createObjectURL(file),void(info.innerHTML=`<small>Dimensi asli: ${img.width}x${img.height} px<br>Ukuran asli: ${(file.size/1024).toFixed(1)} KB</small>`);spinner.style.display="inline-block";const canvas=document.createElement("canvas"),scale=Math.min(345/img.width,1);canvas.width=img.width*scale,canvas.height=img.height*scale,pica().resize(img,canvas).then((()=>pica().toBlob(canvas,"image/jpeg",.85))).then((blob=>{spinner.style.display="none",preview.src=URL.createObjectURL(blob),info.innerHTML=`<small>Dimensi compres: ${canvas.width}x${canvas.height} px<br>Ukuran compres: ${(blob.size/1024).toFixed(1)} KB</small>`;const newFile=new File([blob],file.name,{type:blob.type}),dt=new DataTransfer;dt.items.add(newFile),e.target.files=dt.files}))},img.src=event.target.result},reader.readAsDataURL(file)}))}));