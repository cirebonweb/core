/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
function uploadGambarSingle(){const input=document.querySelector('.unggah input[type="file"]');if(!input)return;const unggah=input.closest(".unggah"),spinner=unggah.querySelector(".loadingSpinner"),preview=unggah.querySelector(`#preview_${input.id}`),info=unggah.querySelector(`#info_${input.id}`);input.addEventListener("change",(function(e){const file=e.target.files[0];if(!file||!file.type.match(/image.*/))return;const reader=new FileReader;reader.onload=function(event){const img=new Image;img.onload=function(){const maxWidth=unggah.dataset.maxWidth?parseInt(unggah.dataset.maxWidth):img.width,quality=unggah.dataset.quality?parseFloat(unggah.dataset.quality):.9,ukuranKB=unggah.dataset.ukuran?parseInt(unggah.dataset.ukuran):100;if(file.size<=1024*ukuranKB)return preview.src=URL.createObjectURL(file),void(info.innerHTML=`<small>Dimensi asli: ${img.width}x${img.height} px<br>Ukuran asli: ${(file.size/1024).toFixed(1)} KB</small>`);spinner.style.display="inline-block",setTimeout((()=>{const canvas=document.createElement("canvas"),scale=Math.min(maxWidth/img.width,1);canvas.width=img.width*scale,canvas.height=img.height*scale,pica().resize(img,canvas).then((()=>pica().toBlob(canvas,"image/jpeg",quality))).then((blob=>{spinner.style.display="none",preview.src=URL.createObjectURL(blob);const width=canvas.width,height=canvas.height,sizeKB=(blob.size/1024).toFixed(1);info.innerHTML=`<small>Dimensi gambar: ${width}x${height} px<br>Ukuran setelah proses: ${sizeKB} KB</small>`;const newFile=new File([blob],file.name,{type:blob.type}),dt=new DataTransfer;dt.items.add(newFile),input.files=dt.files}))}),500)},img.src=event.target.result},reader.readAsDataURL(file)}))}document.addEventListener("DOMContentLoaded",uploadGambarSingle),document.addEventListener("DOMContentLoaded",(function(){uploadGambarSingle();const form=document.querySelector(".form-upload-gambar"),input=form.querySelector('input[type="file"]'),unggah=input.closest(".unggah"),maxSizeKB=parseInt(unggah.dataset.ukuran)||2048;form.addEventListener("submit",(function(e){const file=input.files[0];if(!file)return e.preventDefault(),void Swal.fire('Validasi File','Silakan upload file terlebih dahulu.','warning');file.size>1024*maxSizeKB&&(e.preventDefault(),Swal.fire('Validasi Ukuran',`Ukuran maksimal adalah ${maxSizeKB} KB.`,'error'))}))}));