/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
!function($){class HelperStatBox{constructor(element,options){this.element=$(element),this.options=$.extend({},HelperStatBox.DEFAULTS,options),this.init()}static get DEFAULTS(){return{endpoint:null,statSelector:".stat-value",overlaySelector:".overlay",boxSelector:".small-box, .info-box",fetchDelay:500}}init(){this.options.endpoint&&setTimeout((()=>this.fetchStats()),this.options.fetchDelay)}fetchStats(){$.ajax({url:this.options.endpoint,method:"GET",dataType:"json"}).done((data=>{this.updateStats(data)})).fail((()=>{this.handleFetchError()}))}showOverlay(){this.element.find(this.options.boxSelector).each(((i,boxEl)=>{$(boxEl).find(this.options.overlaySelector).fadeIn(200)}))}refresh(){this.showOverlay(),setTimeout((()=>this.fetchStats()),this.options.fetchDelay)}updateStats(data){this.element.find(this.options.statSelector).each(((i,el)=>{const $el=$(el),key=$el.data("key"),value=data[key]??null;if(null===value)$el.text("–");else{const numericValue=Number(value);!isNaN(numericValue)&&numericValue>=0?this.animateCounter($el,numericValue):$el.text(value)}this.hideOverlay($el)}))}handleFetchError(){this.element.find(this.options.statSelector).each(((i,el)=>{const $el=$(el);$el.text("–"),this.hideOverlay($el)}))}animateCounter($el,target){const totalFrames=Math.ceil(30),step=(target-0)/totalFrames;let count=0;const interval=setInterval((()=>{count+=step,count>=target?($el.text(target),clearInterval(interval)):$el.text(count.toFixed(2))}),20)}hideOverlay($el){$el.closest(this.options.boxSelector).find(this.options.overlaySelector).fadeOut(200)}}$.fn.HelperStatBox=function(options){if("string"==typeof options){const args=Array.prototype.slice.call(arguments,1);return this.each((function(){const instance=$.data(this,"plugin_HelperStatBox");instance&&"function"==typeof instance[options]&&instance[options].apply(instance,args)}))}return this.each((function(){$.data(this,"plugin_HelperStatBox")||$.data(this,"plugin_HelperStatBox",new HelperStatBox(this,options))}))}}(jQuery);