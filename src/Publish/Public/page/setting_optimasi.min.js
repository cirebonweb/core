/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
let baseUrl=window.location.href;window.Lokasi={urlHapusLog:`${baseUrl}/hapus-log`,urlHapusDebug:`${baseUrl}/hapus-debug`,urlDbOptimasi:`${baseUrl}/db-optimasi`,urlDbAnalisis:`${baseUrl}/db-analisis`,urlDbRefresh:`${baseUrl}/db-refresh`,urlDbTabel:`${baseUrl}/db-tabel`};const $statContainer=$(".stat-container"),$tabelData=$("#tabel-data");$(document).ready((function(){$statContainer.HelperStatBox({endpoint:"optimasi/get-info"}),$tabelData.DataTable({ajax:{url:Lokasi.urlDbTabel,type:"POST",dataType:"json",dataSrc:"data"},columns:[{data:"no"},{data:"tabel"},{data:"baris",render:function(data){return parseInt(data)+" data"}},{data:"tipe"},{data:"kelompok"},{data:"ukuran",render:function(data){return parseFloat(data).toFixed(2)+" MB"}},{data:"overhead",render:function(data){return parseFloat(data).toFixed(2)+" KB"}},{data:"dirubah",render:TabelHelper.tabelTanggalWaktu}],order:[[0,"asc"]],paging:!0,searching:!1,responsive:!0,autoWidth:!1,pageLength:25,dom:'<"row mb-2"<"col-sm-2"B><"col-sm-2"l><"col-sm-8"f>><"row"<"col-sm-12"tr>><"row mt-2"<"col-sm-5"i><"col-sm-7"p>>',buttons:["excel",{text:"Refresh",attr:{id:"btn-db-refresh"}}],columnDefs:[{targets:0,width:"5%"},{targets:[0,3,4,7],className:"dt-body-center"},{targets:[2,5,6],className:"dt-body-right"},{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6,7],searchable:!1}],footerCallback:function(row,data){let totalBaris=0,totalUkuran=0,totalOverhead=0;data.forEach((function(d){totalBaris+=parseInt(d.baris),totalUkuran+=parseFloat(d.ukuran),totalOverhead+=parseFloat(d.overhead)}));const api=this.api();$(api.column(2).footer()).html(totalBaris+" data"),$(api.column(5).footer()).html(totalUkuran.toFixed(2)+" MB"),$(api.column(6).footer()).html(totalOverhead.toFixed(2)+" KB"),api.on("xhr.dt",(function(){$statContainer.HelperStatBox("refresh")}))}})})),document.querySelector("#btn-hapus-log").addEventListener("click",(function(){const el=document.querySelector('[data-key="logSize"]');parseFloat(el?.textContent??"0")<=0?Swal.fire({icon:"warning",title:"Peringatan",html:"Ukuran file log 0 MB. <br> Tidak ada yang perlu dibersihkan.",confirmButtonText:"OK"}):FetchHelper.aksiKonfirmasi("#btn-hapus-log","Konfirmasi","Perintah ini akan menghapus semua <br> file log sistem. Lanjutkan?","question",Lokasi.urlHapusLog,null,{onSuccess:()=>$statContainer.HelperStatBox("refresh")})})),document.querySelector("#btn-hapus-debug").addEventListener("click",(function(){const el=document.querySelector('[data-key="debugSize"]');parseFloat(el?.textContent??"0")<=0?Swal.fire({icon:"warning",title:"Peringatan",html:"Ukuran file debug 0 MB. <br> Tidak ada yang perlu dibersihkan.",confirmButtonText:"OK"}):FetchHelper.aksiKonfirmasi("#btn-hapus-debug","Konfirmasi","Perintah ini akan menghapus semua <br> informasi debug. Lanjutkan?","question",Lokasi.urlHapusDebug,null,{useLoading:!0,onSuccess:()=>$statContainer.HelperStatBox("refresh")})})),document.querySelector("#btn-db-optimasi").addEventListener("click",(function(){const cooldownText=document.querySelector('[data-key="dbOptimasiTime"]')?.textContent??"";if(cooldownText.includes("Belum pernah"));else{const match=cooldownText.match(/(\d+)\s+hari/),hari=match?parseInt(match[1]):0;if(hari<30)return void Swal.fire({title:"Peringatan",html:`Optimasi database dapat dilakukan setiap 30 hari. Terakhir dilakukan ${hari} hari yang lalu.`,icon:"warning"})}FetchHelper.aksiKonfirmasi("#btn-db-optimasi","Konfirmasi","Proses Optimasi Database memerlukan waktu beberapa menit. Lanjutkan?","question",Lokasi.urlDbOptimasi,null,{onSuccess:()=>$tabelData.DataTable().ajax.reload(null,!1)})})),document.querySelector("#btn-db-analisis").addEventListener("click",(function(){const cooldownText=document.querySelector('[data-key="dbAnalisisTime"]')?.textContent??"";if(cooldownText.includes("Belum pernah"));else{const match=cooldownText.match(/(\d+)\s+hari/),hari=match?parseInt(match[1]):0;if(hari<30)return void Swal.fire({title:"Peringatan",html:`Analisis database dapat dilakukan setiap 30 hari. Terakhir dilakukan ${hari} hari yang lalu.`,icon:"warning"})}FetchHelper.aksiKonfirmasi("#btn-db-analisis","Konfirmasi","Proses Analisis Database memerlukan waktu beberapa menit. Lanjutkan?","question",Lokasi.urlDbAnalisis,null,{onSuccess:()=>$tabelData.DataTable().ajax.reload(null,!1)})})),FetchHelper.aksiKonfirmasi("#btn-db-refresh","Konfirmasi","Generate ulang tabel database?","question",Lokasi.urlDbRefresh,null,{onSuccess:()=>$tabelData.DataTable().ajax.reload(null,!1)});